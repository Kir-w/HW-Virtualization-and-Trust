#![no_std]
#![no_main]

mod usart;

use usart::{atmega328p::Atmega328pUsart, cortex_m7::CortexM7Usart, Usart};

#[no_mangle]
pub extern "C" fn main() -> ! {
    let usart1 = Atmega328pUsart;
    let usart2 = CortexM7Usart;

    usart1.init(9600); // Initialise l'USART pour l'ATmega328p
    usart2.init(9600); // Initialise l'USART pour le Cortex-M7

    // Exemple de transmission et de réception
    usart1.write_byte(0x41); // Envoie le caractère 'A' à l'ATmega328p
    let received = usart2.read_byte(); // Reçoit un byte sur le Cortex-M7 (simulé ici)

    loop {
        // Vous pouvez aussi ajouter du code pour afficher ou déboguer les communications
    }
}
